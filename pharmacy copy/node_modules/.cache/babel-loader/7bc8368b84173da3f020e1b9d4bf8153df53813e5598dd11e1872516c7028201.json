{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref } from 'vue';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\nimport { useUserStore } from '@/stores/userStore';\nexport default {\n  __name: 'Login',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const userStore = useUserStore();\n\n    // Asegúrate de tener definida la variable de entorno (p. ej., VUE_APP_IP)\n    const ip = process.env.VUE_APP_IP;\n    console.log(\"IP del servidor: \" + ip);\n    const router = useRouter();\n\n    // Campos reactivamente enlazados al formulario\n    const email = ref('');\n    const password = ref('');\n    const errorMessage = ref('');\n    const showModal = ref(false);\n    const userType = ref('');\n    const pharmacy = parseInt(window.location.port);\n    const pharmacy_port = pharmacy - 30;\n    // Función principal de login\n    const login = async () => {\n      errorMessage.value = '';\n      try {\n        console.log(\"Intentando iniciar sesión con:\", email.value);\n\n        // Petición POST al backend\n        const response = await axios.post(`http://${ip}:${pharmacy_port}/api2/login`, {\n          email: email.value,\n          password: password.value\n        });\n\n        // Verificar si la respuesta tiene datos\n        if (!response.data) {\n          throw new Error(\"La respuesta no contiene datos\");\n        }\n\n        // Después de la petición POST exitosa\n        console.log(\"Login exitoso:\", response.data);\n\n        // Guardar el usuario en el store y localStorage\n        const userData = response.data;\n\n        // Sanitizar y verificar los datos\n        if (!userData.role) {\n          userData.role = 'user'; // Rol por defecto si no viene\n        }\n\n        // Guardar en el store\n        userStore.setUser(userData);\n\n        // Guardar explícitamente en localStorage (respaldo adicional)\n        localStorage.setItem('user', JSON.stringify(userData));\n        localStorage.setItem('role', userData.role);\n        console.log(\"Usuario guardado en localStorage con rol:\", userData.role);\n\n        // Verificar el rol y redirigir según corresponda\n        if (userData.role === 'admin') {\n          console.log(\"Redirigiendo a usuario admin a dashboard administrativo\");\n          router.push('/admindash');\n        } else {\n          console.log(\"Redirigiendo a usuario regular a inicio\");\n          router.push('/');\n        }\n      } catch (error) {\n        console.error(\"Error en el login:\", error);\n        errorMessage.value = 'Credenciales incorrectas o error en el servidor.';\n      }\n    };\n    const __returned__ = {\n      userStore,\n      ip,\n      router,\n      email,\n      password,\n      errorMessage,\n      showModal,\n      userType,\n      pharmacy,\n      pharmacy_port,\n      login,\n      ref,\n      get useRouter() {\n        return useRouter;\n      },\n      get axios() {\n        return axios;\n      },\n      get useUserStore() {\n        return useUserStore;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","useRouter","axios","useUserStore","userStore","ip","process","env","VUE_APP_IP","console","log","router","email","password","errorMessage","showModal","userType","pharmacy","parseInt","window","location","port","pharmacy_port","login","value","response","post","data","Error","userData","role","setUser","localStorage","setItem","JSON","stringify","push","error"],"sources":["/Users/nohelestradap/Documents/VsCode/ensurancePharmacy/pharmacy/src/pages/Login.vue"],"sourcesContent":["<!-- eslint-disable vue/multi-word-component-names -->\n<template>\n  <div class=\"login-container\">\n    <div class=\"login-image\"></div>\n\n    <div class=\"login-box\">\n      <div class=\"logo-container\">\n        <img src=\"@/assets/logo.png\" alt=\"Farmacia Logo\" class=\"logo\" />\n      </div>\n\n      <h2 class=\"text-2xl font-bold text-center text-blue-800 mb-4\">\n        Iniciar Sesión\n      </h2>\n\n      <!-- Mensaje de error si lo hay -->\n      <div v-if=\"errorMessage\" class=\"mb-4 text-red-600 text-center\">\n        {{ errorMessage }}\n      </div>\n\n      <!-- Formulario -->\n      <form @submit.prevent=\"()=>login()\">\n        <!-- E-mail -->\n        <div class=\"mb-4\">\n          <label class=\"block text-gray-700\">E-mail</label>\n          <div class=\"input-group\">\n            <input\n              v-model=\"email\"\n              type=\"text\"\n              class=\"input-field\"\n              required\n            />\n            <span class=\"icon\">👤</span>\n          </div>\n        </div>\n        \n        <!-- Contraseña -->\n        <div class=\"mb-4\">\n          <label class=\"block text-gray-700\">Contraseña</label>\n          <div class=\"input-group\">\n            <input\n              v-model=\"password\"\n              type=\"password\"\n              class=\"input-field\"\n              required\n            />\n            <span class=\"icon\">🔒</span>\n          </div>\n        </div>\n\n        <!-- Botón de inicio de sesión -->\n        <button type=\"submit\" class=\"login-button\">\n          Iniciar sesión →\n        </button>\n      </form>\n\n      <!-- Enlace para registrarse -->\n      <div class=\"text-center mt-4\">\n        <router-link to=\"/register\" class=\"text-blue-500 hover:underline\">\n          Regístrarse aquí\n        </router-link>\n      </div>\n    </div>\n  </div>\n\n  <!-- Modal para mostrar el tipo de usuario -->\n  <div v-if=\"showModal\" class=\"modal\">\n    <div class=\"modal-content\">\n      <span class=\"close\" @click=\"showModal = false\">&times;</span>\n      <p>Tipo de usuario: {{ userType }}</p>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref } from 'vue';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\nimport { useUserStore } from '@/stores/userStore'\nconst userStore = useUserStore();\n\n// Asegúrate de tener definida la variable de entorno (p. ej., VUE_APP_IP)\nconst ip = process.env.VUE_APP_IP;\nconsole.log(\"IP del servidor: \" + ip);\n\nconst router = useRouter();\n\n// Campos reactivamente enlazados al formulario\nconst email = ref('');\nconst password = ref('');\nconst errorMessage = ref('');\nconst showModal = ref(false);\nconst userType = ref('');\nconst pharmacy = parseInt(window.location.port);\nconst pharmacy_port = pharmacy-30;\n// Función principal de login\nconst login = async () => {\n  errorMessage.value = '';\n  \n  try {\n    console.log(\"Intentando iniciar sesión con:\", email.value);\n    \n    // Petición POST al backend\n    const response = await axios.post(`http://${ip}:${pharmacy_port}/api2/login`, {\n      email: email.value,\n      password: password.value\n    });\n\n    // Verificar si la respuesta tiene datos\n    if (!response.data) {\n      throw new Error(\"La respuesta no contiene datos\");\n    }\n\n    // Después de la petición POST exitosa\n    console.log(\"Login exitoso:\", response.data);\n\n    // Guardar el usuario en el store y localStorage\n    const userData = response.data;\n    \n    // Sanitizar y verificar los datos\n    if (!userData.role) {\n      userData.role = 'user'; // Rol por defecto si no viene\n    }\n    \n    // Guardar en el store\n    userStore.setUser(userData);\n\n    // Guardar explícitamente en localStorage (respaldo adicional)\n    localStorage.setItem('user', JSON.stringify(userData));\n    localStorage.setItem('role', userData.role);\n    console.log(\"Usuario guardado en localStorage con rol:\", userData.role);\n\n    // Verificar el rol y redirigir según corresponda\n    if (userData.role === 'admin') {\n      console.log(\"Redirigiendo a usuario admin a dashboard administrativo\");\n      router.push('/admindash');\n    } else {\n      console.log(\"Redirigiendo a usuario regular a inicio\");\n      router.push('/');\n    }\n  } catch (error) {\n    console.error(\"Error en el login:\", error);\n    errorMessage.value = 'Credenciales incorrectas o error en el servidor.';\n  }\n};\n</script>\n\n<style scoped>\n/* Ejemplo de estilos, ajusta a tu gusto. */\n.login-container {\n  display: flex;\n  height: 100vh;\n  background-color: #f8f9fa;\n}\n.login-image {\n  flex: 1;\n  background-image: url(@/assets/farmacialog.jpg);\n  background-position: center;\n  background-size: cover;\n}\n.login-box {\n  flex: 1;\n  background: white;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  padding: 50px;\n}\n.logo {\n  max-width: 150px;\n}\n.input-group {\n  position: relative;\n  width: 100%;\n}\n.input-field {\n  width: 100%;\n  padding: 12px 40px 12px 12px;\n  border: 1px solid #ccc;\n  border-radius: 8px;\n  font-size: 16px;\n}\n.icon {\n  position: absolute;\n  right: 10px;\n  top: 50%;\n  transform: translateY(-50%);\n}\n.login-button {\n  width: 100%;\n  background: #1e40af;\n  color: white;\n  padding: 12px;\n  border-radius: 8px;\n  font-size: 18px;\n  font-weight: bold;\n  cursor: pointer;\n  margin-top: 1rem;\n}\n.login-button:hover {\n  background: #1e3a8a;\n}\n\n.modal {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: fixed;\n  z-index: 1;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n}\n\n.modal-content {\n  background-color: white;\n  padding: 20px;\n  border-radius: 8px;\n  text-align: center;\n}\n\n.close {\n  position: absolute;\n  top: 10px;\n  right: 10px;\n  font-size: 24px;\n  cursor: pointer;\n}\n</style>"],"mappings":";AA0EA,SAASA,GAAG,QAAQ,KAAK;AACzB,SAASC,SAAS,QAAQ,YAAY;AACtC,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,YAAY,QAAQ,oBAAmB;;;;;;;IAChD,MAAMC,SAAS,GAAGD,YAAY,CAAC,CAAC;;IAEhC;IACA,MAAME,EAAE,GAAGC,OAAO,CAACC,GAAG,CAACC,UAAU;IACjCC,OAAO,CAACC,GAAG,CAAC,mBAAmB,GAAGL,EAAE,CAAC;IAErC,MAAMM,MAAM,GAAGV,SAAS,CAAC,CAAC;;IAE1B;IACA,MAAMW,KAAK,GAAGZ,GAAG,CAAC,EAAE,CAAC;IACrB,MAAMa,QAAQ,GAAGb,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMc,YAAY,GAAGd,GAAG,CAAC,EAAE,CAAC;IAC5B,MAAMe,SAAS,GAAGf,GAAG,CAAC,KAAK,CAAC;IAC5B,MAAMgB,QAAQ,GAAGhB,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMiB,QAAQ,GAAGC,QAAQ,CAACC,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAC;IAC/C,MAAMC,aAAa,GAAGL,QAAQ,GAAC,EAAE;IACjC;IACA,MAAMM,KAAK,GAAG,MAAAA,CAAA,KAAY;MACxBT,YAAY,CAACU,KAAK,GAAG,EAAE;MAEvB,IAAI;QACFf,OAAO,CAACC,GAAG,CAAC,gCAAgC,EAAEE,KAAK,CAACY,KAAK,CAAC;;QAE1D;QACA,MAAMC,QAAQ,GAAG,MAAMvB,KAAK,CAACwB,IAAI,CAAC,UAAUrB,EAAE,IAAIiB,aAAa,aAAa,EAAE;UAC5EV,KAAK,EAAEA,KAAK,CAACY,KAAK;UAClBX,QAAQ,EAAEA,QAAQ,CAACW;QACrB,CAAC,CAAC;;QAEF;QACA,IAAI,CAACC,QAAQ,CAACE,IAAI,EAAE;UAClB,MAAM,IAAIC,KAAK,CAAC,gCAAgC,CAAC;QACnD;;QAEA;QACAnB,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAEe,QAAQ,CAACE,IAAI,CAAC;;QAE5C;QACA,MAAME,QAAQ,GAAGJ,QAAQ,CAACE,IAAI;;QAE9B;QACA,IAAI,CAACE,QAAQ,CAACC,IAAI,EAAE;UAClBD,QAAQ,CAACC,IAAI,GAAG,MAAM,CAAC,CAAC;QAC1B;;QAEA;QACA1B,SAAS,CAAC2B,OAAO,CAACF,QAAQ,CAAC;;QAE3B;QACAG,YAAY,CAACC,OAAO,CAAC,MAAM,EAAEC,IAAI,CAACC,SAAS,CAACN,QAAQ,CAAC,CAAC;QACtDG,YAAY,CAACC,OAAO,CAAC,MAAM,EAAEJ,QAAQ,CAACC,IAAI,CAAC;QAC3CrB,OAAO,CAACC,GAAG,CAAC,2CAA2C,EAAEmB,QAAQ,CAACC,IAAI,CAAC;;QAEvE;QACA,IAAID,QAAQ,CAACC,IAAI,KAAK,OAAO,EAAE;UAC7BrB,OAAO,CAACC,GAAG,CAAC,yDAAyD,CAAC;UACtEC,MAAM,CAACyB,IAAI,CAAC,YAAY,CAAC;QAC3B,CAAC,MAAM;UACL3B,OAAO,CAACC,GAAG,CAAC,yCAAyC,CAAC;UACtDC,MAAM,CAACyB,IAAI,CAAC,GAAG,CAAC;QAClB;MACF,CAAC,CAAC,OAAOC,KAAK,EAAE;QACd5B,OAAO,CAAC4B,KAAK,CAAC,oBAAoB,EAAEA,KAAK,CAAC;QAC1CvB,YAAY,CAACU,KAAK,GAAG,kDAAkD;MACzE;IACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
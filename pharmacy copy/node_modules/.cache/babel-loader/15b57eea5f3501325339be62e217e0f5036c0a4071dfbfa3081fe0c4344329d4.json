{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport { ref, onMounted } from 'vue';\nimport axios from 'axios';\nimport { useUserStore } from '@/stores/userStore';\nexport default {\n  __name: 'Cart',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const userStore = useUserStore();\n    const ip = process.env.VUE_APP_API_IP || 'localhost';\n    const currentOrder = ref(null);\n    const cartItems = ref([]);\n\n    // Buscar la orden en progreso para el usuario actual\n    const fetchCurrentOrder = async () => {\n      try {\n        const ordersResponse = await axios.get(`http://${ip}:8081/api2/orders`);\n        const orders = ordersResponse.data;\n        const userId = userStore.getUser().idUser;\n        const inProgressOrder = orders.find(o => o.user.idUser === userId && o.status === 'En progreso');\n        currentOrder.value = inProgressOrder || null;\n      } catch (error) {\n        console.error('Error fetching current order:', error);\n      }\n    };\n\n    // Obtener los ítems (OrderMedicine) de la orden en progreso\n    const fetchCartItems = async orderId => {\n      try {\n        const response = await axios.get(`http://${ip}:8081/api2/order_medicines`);\n        const allItems = response.data;\n        // Filtrar solo los ítems que corresponden a la orden en progreso\n        cartItems.value = allItems.filter(item => item.orders.idOrder === orderId);\n      } catch (error) {\n        console.error('Error fetching cart items:', error);\n      }\n    };\n\n    // Eliminar un ítem del carrito (se elimina directamente de la DB)\n    const removeItem = async item => {\n      try {\n        const orderId = item.orders.idOrder;\n        const medicineId = item.medicine.idMedicine;\n        await axios.delete(`http://${ip}:8081/api2/order_medicines?id=${orderId},${medicineId}`);\n        // Actualizar la lista local eliminando el ítem borrado\n        cartItems.value = cartItems.value.filter(i => i.medicine.idMedicine !== medicineId);\n      } catch (error) {\n        console.error('Error removing item from cart:', error);\n      }\n    };\n    onMounted(async () => {\n      await fetchCurrentOrder();\n      if (currentOrder.value) {\n        await fetchCartItems(currentOrder.value.idOrder);\n      }\n    });\n    const __returned__ = {\n      userStore,\n      ip,\n      currentOrder,\n      cartItems,\n      fetchCurrentOrder,\n      fetchCartItems,\n      removeItem,\n      ref,\n      onMounted,\n      get axios() {\n        return axios;\n      },\n      get useUserStore() {\n        return useUserStore;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","axios","useUserStore","userStore","ip","process","env","VUE_APP_API_IP","currentOrder","cartItems","fetchCurrentOrder","ordersResponse","get","orders","data","userId","getUser","idUser","inProgressOrder","find","o","user","status","value","error","console","fetchCartItems","orderId","response","allItems","filter","item","idOrder","removeItem","medicineId","medicine","idMedicine","delete","i"],"sources":["/Users/nohelestradap/Documents/VsCode/ensurancePharmacy/pharmacy/src/components/Cart.vue"],"sourcesContent":["<!-- eslint-disable vue/multi-word-component-names -->\n<template>\n  <div class=\"cart-container\">\n    <h1>Carrito de Compras</h1>\n\n    <!-- Si no existe una orden en progreso -->\n    <div v-if=\"!currentOrder\">\n      <p>No tienes una orden en progreso.</p>\n    </div>\n\n    <!-- Si existe una orden en progreso, se muestran los ítems -->\n    <div v-else>\n      <table>\n        <thead>\n        <tr>\n          <th>Medicamento</th>\n          <th>Cantidad</th>\n          <th>Costo Unitario</th>\n          <th>Total</th>\n          <th>Eliminar</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr v-for=\"item in cartItems\" :key=\"item.medicine.idMedicine\">\n          <td>{{ item.medicine.name }}</td>\n          <td>{{ item.quantity }}</td>\n          <td>{{ item.cost }}</td>\n          <td>{{ item.total }}</td>\n          <td>\n            <button @click=\"removeItem(item)\">X</button>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</template>\n\n<script setup name=\"CartView\">\nimport { ref, onMounted } from 'vue'\nimport axios from 'axios'\nimport { useUserStore } from '@/stores/userStore'\n\nconst userStore = useUserStore()\nconst ip = process.env.VUE_APP_API_IP || 'localhost'\n\nconst currentOrder = ref(null)\nconst cartItems = ref([])\n\n// Buscar la orden en progreso para el usuario actual\nconst fetchCurrentOrder = async () => {\n  try {\n    const ordersResponse = await axios.get(`http://${ip}:8081/api2/orders`)\n    const orders = ordersResponse.data\n    const userId = userStore.getUser().idUser\n    const inProgressOrder = orders.find(o => o.user.idUser === userId && o.status === 'En progreso')\n    currentOrder.value = inProgressOrder || null\n  } catch (error) {\n    console.error('Error fetching current order:', error)\n  }\n}\n\n// Obtener los ítems (OrderMedicine) de la orden en progreso\nconst fetchCartItems = async (orderId) => {\n  try {\n    const response = await axios.get(`http://${ip}:8081/api2/order_medicines`)\n    const allItems = response.data\n    // Filtrar solo los ítems que corresponden a la orden en progreso\n    cartItems.value = allItems.filter(item => item.orders.idOrder === orderId)\n  } catch (error) {\n    console.error('Error fetching cart items:', error)\n  }\n}\n\n// Eliminar un ítem del carrito (se elimina directamente de la DB)\nconst removeItem = async (item) => {\n  try {\n    const orderId = item.orders.idOrder\n    const medicineId = item.medicine.idMedicine\n    await axios.delete(`http://${ip}:8081/api2/order_medicines?id=${orderId},${medicineId}`)\n    // Actualizar la lista local eliminando el ítem borrado\n    cartItems.value = cartItems.value.filter(i => i.medicine.idMedicine !== medicineId)\n  } catch (error) {\n    console.error('Error removing item from cart:', error)\n  }\n}\n\nonMounted(async () => {\n  await fetchCurrentOrder()\n  if (currentOrder.value) {\n    await fetchCartItems(currentOrder.value.idOrder)\n  }\n})\n</script>\n\n<style scoped>\n.cart-container {\n  max-width: 800px;\n  margin: 0 auto;\n  padding: 20px;\n}\n\ntable {\n  width: 100%;\n  border-collapse: collapse;\n  margin-top: 20px;\n}\n\nth, td {\n  padding: 8px;\n  border: 1px solid #ccc;\n  text-align: left;\n}\n</style>"],"mappings":";;;AAuCA,SAASA,GAAG,EAAEC,SAAS,QAAQ,KAAI;AACnC,OAAOC,KAAK,MAAM,OAAM;AACxB,SAASC,YAAY,QAAQ,oBAAmB;;;;;;;IAEhD,MAAMC,SAAS,GAAGD,YAAY,CAAC;IAC/B,MAAME,EAAE,GAAGC,OAAO,CAACC,GAAG,CAACC,cAAc,IAAI,WAAU;IAEnD,MAAMC,YAAY,GAAGT,GAAG,CAAC,IAAI;IAC7B,MAAMU,SAAS,GAAGV,GAAG,CAAC,EAAE;;IAExB;IACA,MAAMW,iBAAiB,GAAG,MAAAA,CAAA,KAAY;MACpC,IAAI;QACF,MAAMC,cAAc,GAAG,MAAMV,KAAK,CAACW,GAAG,CAAC,UAAUR,EAAE,mBAAmB;QACtE,MAAMS,MAAM,GAAGF,cAAc,CAACG,IAAG;QACjC,MAAMC,MAAM,GAAGZ,SAAS,CAACa,OAAO,CAAC,CAAC,CAACC,MAAK;QACxC,MAAMC,eAAe,GAAGL,MAAM,CAACM,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,IAAI,CAACJ,MAAM,KAAKF,MAAM,IAAIK,CAAC,CAACE,MAAM,KAAK,aAAa;QAC/Fd,YAAY,CAACe,KAAK,GAAGL,eAAe,IAAI,IAAG;MAC7C,CAAC,CAAC,OAAOM,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,+BAA+B,EAAEA,KAAK;MACtD;IACF;;IAEA;IACA,MAAME,cAAc,GAAG,MAAOC,OAAO,IAAK;MACxC,IAAI;QACF,MAAMC,QAAQ,GAAG,MAAM3B,KAAK,CAACW,GAAG,CAAC,UAAUR,EAAE,4BAA4B;QACzE,MAAMyB,QAAQ,GAAGD,QAAQ,CAACd,IAAG;QAC7B;QACAL,SAAS,CAACc,KAAK,GAAGM,QAAQ,CAACC,MAAM,CAACC,IAAI,IAAIA,IAAI,CAAClB,MAAM,CAACmB,OAAO,KAAKL,OAAO;MAC3E,CAAC,CAAC,OAAOH,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,4BAA4B,EAAEA,KAAK;MACnD;IACF;;IAEA;IACA,MAAMS,UAAU,GAAG,MAAOF,IAAI,IAAK;MACjC,IAAI;QACF,MAAMJ,OAAO,GAAGI,IAAI,CAAClB,MAAM,CAACmB,OAAM;QAClC,MAAME,UAAU,GAAGH,IAAI,CAACI,QAAQ,CAACC,UAAS;QAC1C,MAAMnC,KAAK,CAACoC,MAAM,CAAC,UAAUjC,EAAE,iCAAiCuB,OAAO,IAAIO,UAAU,EAAE;QACvF;QACAzB,SAAS,CAACc,KAAK,GAAGd,SAAS,CAACc,KAAK,CAACO,MAAM,CAACQ,CAAC,IAAIA,CAAC,CAACH,QAAQ,CAACC,UAAU,KAAKF,UAAU;MACpF,CAAC,CAAC,OAAOV,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,gCAAgC,EAAEA,KAAK;MACvD;IACF;IAEAxB,SAAS,CAAC,YAAY;MACpB,MAAMU,iBAAiB,CAAC;MACxB,IAAIF,YAAY,CAACe,KAAK,EAAE;QACtB,MAAMG,cAAc,CAAClB,YAAY,CAACe,KAAK,CAACS,OAAO;MACjD;IACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport Comentarios from '@/components/Comentarios.vue';\nimport axios from \"axios\";\nimport { useUserStore } from '@/stores/userStore';\nconst pharmacy = parseInt(window.location.port);\nconst pharmacy_port = pharmacy - 30;\nconst ip = process.env.VUE_APP_IP;\nexport default {\n  name: \"ProductoDetalle\",\n  components: {\n    Comentarios\n  },\n  // Se recibe el id del producto vía props (asegúrate de que el router lo pase correctamente)\n  props: [\"id\"],\n  data() {\n    return {\n      product: null,\n      quantity: 1,\n      productComments: [{\n        idComments: 1,\n        user: {\n          name: 'Juan'\n        },\n        commentText: '¡Muy buen producto!'\n      }, {\n        idComments: 2,\n        user: {\n          name: 'Maria'\n        },\n        commentText: 'Me ayudó mucho, gracias!'\n      }]\n    };\n  },\n  mounted() {\n    const routeId = this.$route.params.id;\n    axios.get(`http://${ip}:8081/api2/medicines`).then(response => {\n      const products = response.data;\n      console.log(this.$route.params.id);\n      this.product = products.find(prod => prod.idMedicine === Number(routeId));\n    }).catch(error => {\n      console.error('Error fetching medicines:', error);\n    });\n  },\n  methods: {\n    redirectToCheckout() {\n      // Verificar si el usuario está logueado\n      const userStore = useUserStore();\n      if (!userStore.user) {\n        // Si no está logueado, redirigir a login\n        this.$router.push('/login');\n        return;\n      }\n\n      // Redirigir a la página de verificación de compra\n      this.$router.push({\n        name: 'VerificarCompra',\n        params: {\n          id: this.product.idMedicine\n        },\n        query: {\n          quantity: this.quantity\n        }\n      });\n    },\n    purchaseProduct() {\n      const userStore = useUserStore();\n      const userId = userStore.user.idUser;\n\n      // Obtener todas las órdenes para el usuario\n      axios.get(`http://${ip}:8081/api2/orders?userId=${userId}`).then(response => {\n        console.log('Response from orders GET:', response.data);\n        const orders = response.data;\n        const orderInProgress = orders.find(order => order.status === 'En progreso');\n        if (orderInProgress) {\n          console.log('Found order in progress:', orderInProgress);\n          return orderInProgress;\n        } else {\n          return axios.post(`http://${ip}:8081/api2/orders`, {\n            user: {\n              idUser: userId\n            },\n            status: 'En progreso'\n          }).then(response => {\n            console.log('Response from orders POST:', response.data);\n            return response.data;\n          });\n        }\n      }).then(order => {\n        console.log('ORDEN:', order);\n        return axios.get(`http://${ip}:8081/api2/order_medicines?id=${order.idOrder}%2C${this.product.idMedicine}`).then(response => {\n          let items = response.data;\n          if (!Array.isArray(items)) items = items ? [items] : [];\n          return items;\n        }).catch(error => {\n          if (error.response?.status === 404) return []; // no existe → crear\n          throw error;\n        }).then(orderMedicines => {\n          const existing = orderMedicines.find(om => om.medicine.idMedicine === this.product.idMedicine);\n          const payload = {\n            orders: order,\n            medicine: {\n              idMedicine: this.product.idMedicine\n            },\n            quantity: this.quantity,\n            cost: this.product.price,\n            total: this.product.price * this.quantity\n          };\n          return existing ? axios.put(`http://${ip}:8081/api2/order_medicines`, payload) : axios.post(`http://${ip}:8081/api2/order_medicines`, payload);\n        });\n      }).then(response => {\n        console.log('Orden y medicamento añadidos o actualizados:', response.data);\n      }).catch(error => {\n        console.error('Error en el proceso de la orden:', error);\n      });\n    }\n  }\n};","map":{"version":3,"names":["Comentarios","axios","useUserStore","pharmacy","parseInt","window","location","port","pharmacy_port","ip","process","env","VUE_APP_IP","name","components","props","data","product","quantity","productComments","idComments","user","commentText","mounted","routeId","$route","params","id","get","then","response","products","console","log","find","prod","idMedicine","Number","catch","error","methods","redirectToCheckout","userStore","$router","push","query","purchaseProduct","userId","idUser","orders","orderInProgress","order","status","post","idOrder","items","Array","isArray","orderMedicines","existing","om","medicine","payload","cost","price","total","put"],"sources":["/Users/nohelestradap/Documents/VsCode/ensurancePharmacy/pharmacy/src/pages/ProductoDetalle.vue"],"sourcesContent":["<!-- eslint-disable vue/multi-word-component-names -->\n<template>\n    <div>\n      <h1>Detalle del Producto</h1>\n\n      <!-- Si el producto existe, mostramos su información -->\n      <div v-if=\"product\">\n        <div class=\"product-container\" style=\"display: flex;\">\n          <div class=\"product-details\" style=\"flex: 1;\">\n            <h2>{{ product.name }}</h2>\n            <img\n              v-if=\"product.images && product.images.length\"\n              :src=\"product.images[0]\"\n              alt=\"Imagen principal del producto\"\n              style=\"width: 200px; border-radius: 8px;\"\n            />\n            <p><strong>Precio:</strong> Q{{ product.price }}</p>\n            <p><strong>Descripción:</strong> {{ product.description }}</p>\n            <p><strong>Inventario:</strong> {{ product.stock }} unidades</p>\n            <p><strong>Ingrediente Activo:</strong> {{ product.activeMedicament }}</p>\n            <p><strong>Descripción:</strong> {{ product.description }}</p>\n            <p><strong>Concentración:</strong> {{ product.concentration }}</p>\n            <p><strong>Presentación:</strong> {{ product.presentacion }}</p>\n            <p><strong>Marca:</strong> {{ product.brand }}</p>\n          </div>\n          <div class=\"purchase-section\" style=\"margin-left: 20px;\">\n            <label for=\"quantity\">Cantidad:</label>\n            <input\n              type=\"number\"\n              id=\"quantity\"\n              v-model.number=\"quantity\"\n              :min=\"1\"\n              :max=\"product.stock\"\n              style=\"width: 60px; margin-left: 10px;\"\n            />\n            <button\n              @click=\"redirectToCheckout\"\n              :disabled=\"!quantity || quantity < 1 || quantity > product.stock\"\n              style=\"margin-left: 10px;\"\n            >\n              Comprar\n            </button>\n          </div>\n        </div>\n        <Comentarios :initialComments=\"productComments\" />\n      </div>\n      <!-- Si no existe el producto, mostramos un mensaje de error -->\n      <div v-else>\n        <p>Producto no encontrado.</p>\n      </div>\n    </div>\n  </template>\n\n  <script>\n  import Comentarios from '@/components/Comentarios.vue';\n  import axios from \"axios\";\n  import { useUserStore } from '@/stores/userStore';\n\n  const pharmacy = parseInt(window.location.port);\n  const pharmacy_port = pharmacy-30;\n  const ip = process.env.VUE_APP_IP;\n\n  export default {\n    name: \"ProductoDetalle\",\n    components: {\n      Comentarios\n    },\n    // Se recibe el id del producto vía props (asegúrate de que el router lo pase correctamente)\n    props: [\"id\"],\n    data() {\n      return {\n        product: null,\n        quantity: 1,\n        productComments: [\n          { idComments: 1, user: { name: 'Juan' }, commentText: '¡Muy buen producto!' },\n          { idComments: 2, user: { name: 'Maria' }, commentText: 'Me ayudó mucho, gracias!' }\n        ]\n      };\n    },\n    mounted() {\n      const routeId = this.$route.params.id;\n      axios.get(`http://${ip}:8081/api2/medicines`)\n          .then(response => {\n            const products = response.data;\n            console.log(this.$route.params.id);\n            this.product = products.find(prod => prod.idMedicine === Number(routeId));\n          })\n          .catch(error => {\n            console.error('Error fetching medicines:', error);\n          });\n    },\n    methods: {\n      redirectToCheckout() {\n        // Verificar si el usuario está logueado\n        const userStore = useUserStore();\n        if (!userStore.user) {\n          // Si no está logueado, redirigir a login\n          this.$router.push('/login');\n          return;\n        }\n        \n        // Redirigir a la página de verificación de compra\n        this.$router.push({\n          name: 'VerificarCompra',\n          params: { id: this.product.idMedicine },\n          query: { quantity: this.quantity }\n        });\n      },\n      \n      purchaseProduct() {\n        const userStore = useUserStore();\n        const userId = userStore.user.idUser;\n\n        // Obtener todas las órdenes para el usuario\n        axios.get(`http://${ip}:8081/api2/orders?userId=${userId}`)\n          .then(response => {\n            console.log('Response from orders GET:', response.data);\n            const orders = response.data;\n            const orderInProgress = orders.find(order => order.status === 'En progreso');\n            if (orderInProgress) {\n              console.log('Found order in progress:', orderInProgress);\n              return orderInProgress;\n            } else {\n              return axios.post(`http://${ip}:8081/api2/orders`, {\n                user: { idUser: userId },\n                status: 'En progreso'\n              }).then(response => {\n                console.log('Response from orders POST:', response.data);\n                return response.data;\n              });\n            }\n          })\n          .then(order => {\n            console.log('ORDEN:', order);\n            return axios.get(`http://${ip}:8081/api2/order_medicines?id=${order.idOrder}%2C${this.product.idMedicine}`)\n                .then(response => {\n                  let items = response.data;\n                  if (!Array.isArray(items)) items = items ? [items] : [];\n                  return items;\n                })\n                .catch(error => {\n                  if (error.response?.status === 404) return [];    // no existe → crear\n                  throw error;\n                })\n                .then(orderMedicines => {\n                  const existing = orderMedicines.find(om => om.medicine.idMedicine === this.product.idMedicine);\n                  const payload = {\n                    orders: order,\n                    medicine: { idMedicine: this.product.idMedicine },\n                    quantity: this.quantity,\n                    cost: this.product.price,\n                    total: this.product.price * this.quantity\n                  };\n                  return existing\n                      ? axios.put(`http://${ip}:8081/api2/order_medicines`, payload)\n                      : axios.post(`http://${ip}:8081/api2/order_medicines`, payload);\n                });\n          })\n          .then(response => {\n            console.log('Orden y medicamento añadidos o actualizados:', response.data);\n          })\n          .catch(error => {\n            console.error('Error en el proceso de la orden:', error);\n          });\n      }\n    }\n  };\n  </script>\n\n  <style scoped>\n  /* Estilos opcionales */\n  </style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
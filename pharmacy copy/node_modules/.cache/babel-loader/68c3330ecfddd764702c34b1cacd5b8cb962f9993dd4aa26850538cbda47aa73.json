{"ast":null,"code":"import { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, vModelText as _vModelText, withDirectives as _withDirectives, withModifiers as _withModifiers, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, Fragment as _Fragment } from \"vue\";\nimport _imports_0 from '@/assets/logo.png';\nconst _hoisted_1 = {\n  class: \"login-container\"\n};\nconst _hoisted_2 = {\n  class: \"login-box\"\n};\nconst _hoisted_3 = {\n  key: 0,\n  class: \"mb-4 text-red-600 text-center\"\n};\nconst _hoisted_4 = {\n  class: \"mb-4\"\n};\nconst _hoisted_5 = {\n  class: \"input-group\"\n};\nconst _hoisted_6 = {\n  class: \"mb-4\"\n};\nconst _hoisted_7 = {\n  class: \"input-group\"\n};\nconst _hoisted_8 = {\n  class: \"text-center mt-4\"\n};\nconst _hoisted_9 = {\n  key: 0,\n  class: \"modal\"\n};\nconst _hoisted_10 = {\n  class: \"modal-content\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_router_link = _resolveComponent(\"router-link\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"div\", _hoisted_1, [_cache[12] || (_cache[12] = _createElementVNode(\"div\", {\n    class: \"login-image\"\n  }, null, -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_2, [_cache[10] || (_cache[10] = _createElementVNode(\"div\", {\n    class: \"logo-container\"\n  }, [_createElementVNode(\"img\", {\n    src: _imports_0,\n    alt: \"Farmacia Logo\",\n    class: \"logo\"\n  })], -1 /* HOISTED */)), _cache[11] || (_cache[11] = _createElementVNode(\"h2\", {\n    class: \"text-2xl font-bold text-center text-blue-800 mb-4\"\n  }, \" Iniciar Sesi√≥n \", -1 /* HOISTED */)), _createCommentVNode(\" Mensaje de error si lo hay \"), $setup.errorMessage ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, _toDisplayString($setup.errorMessage), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" Formulario \"), _createElementVNode(\"form\", {\n    onSubmit: _cache[2] || (_cache[2] = _withModifiers(() => $setup.login(), [\"prevent\"]))\n  }, [_createCommentVNode(\" E-mail \"), _createElementVNode(\"div\", _hoisted_4, [_cache[5] || (_cache[5] = _createElementVNode(\"label\", {\n    class: \"block text-gray-700\"\n  }, \"E-mail\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_5, [_withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.email = $event),\n    type: \"text\",\n    class: \"input-field\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.email]]), _cache[4] || (_cache[4] = _createElementVNode(\"span\", {\n    class: \"icon\"\n  }, \"üë§\", -1 /* HOISTED */))])]), _createCommentVNode(\" Contrase√±a \"), _createElementVNode(\"div\", _hoisted_6, [_cache[7] || (_cache[7] = _createElementVNode(\"label\", {\n    class: \"block text-gray-700\"\n  }, \"Contrase√±a\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_7, [_withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.password = $event),\n    type: \"password\",\n    class: \"input-field\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.password]]), _cache[6] || (_cache[6] = _createElementVNode(\"span\", {\n    class: \"icon\"\n  }, \"üîí\", -1 /* HOISTED */))])]), _createCommentVNode(\" Bot√≥n de inicio de sesi√≥n \"), _cache[8] || (_cache[8] = _createElementVNode(\"button\", {\n    type: \"submit\",\n    class: \"login-button\"\n  }, \" Iniciar sesi√≥n ‚Üí \", -1 /* HOISTED */))], 32 /* NEED_HYDRATION */), _createCommentVNode(\" Enlace para registrarse \"), _createElementVNode(\"div\", _hoisted_8, [_createVNode(_component_router_link, {\n    to: \"/register\",\n    class: \"text-blue-500 hover:underline\"\n  }, {\n    default: _withCtx(() => _cache[9] || (_cache[9] = [_createTextVNode(\" Reg√≠strarse aqu√≠ \")])),\n    _: 1 /* STABLE */\n  })])])]), _createCommentVNode(\" Modal para mostrar el tipo de usuario \"), $setup.showModal ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [_createElementVNode(\"div\", _hoisted_10, [_createElementVNode(\"span\", {\n    class: \"close\",\n    onClick: _cache[3] || (_cache[3] = $event => $setup.showModal = false)\n  }, \"√ó\"), _createElementVNode(\"p\", null, \"Tipo de usuario: \" + _toDisplayString($setup.userType), 1 /* TEXT */)])])) : _createCommentVNode(\"v-if\", true)], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["_imports_0","class","key","_createElementBlock","_Fragment","_createElementVNode","_hoisted_1","_hoisted_2","src","alt","_createCommentVNode","$setup","errorMessage","_hoisted_3","_toDisplayString","onSubmit","_cache","_withModifiers","login","_hoisted_4","_hoisted_5","$event","email","type","required","_hoisted_6","_hoisted_7","password","_hoisted_8","_createVNode","_component_router_link","to","default","_withCtx","_createTextVNode","_","showModal","_hoisted_9","_hoisted_10","onClick","userType"],"sources":["/Users/nohelestradap/Documents/VsCode/ensurancePharmacy/pharmacy copy/src/pages/Login.vue"],"sourcesContent":["<!-- eslint-disable vue/multi-word-component-names -->\n<template>\n  <div class=\"login-container\">\n    <div class=\"login-image\"></div>\n\n    <div class=\"login-box\">\n      <div class=\"logo-container\">\n        <img src=\"@/assets/logo.png\" alt=\"Farmacia Logo\" class=\"logo\" />\n      </div>\n\n      <h2 class=\"text-2xl font-bold text-center text-blue-800 mb-4\">\n        Iniciar Sesi√≥n\n      </h2>\n\n      <!-- Mensaje de error si lo hay -->\n      <div v-if=\"errorMessage\" class=\"mb-4 text-red-600 text-center\">\n        {{ errorMessage }}\n      </div>\n\n      <!-- Formulario -->\n      <form @submit.prevent=\"()=>login()\">\n        <!-- E-mail -->\n        <div class=\"mb-4\">\n          <label class=\"block text-gray-700\">E-mail</label>\n          <div class=\"input-group\">\n            <input\n              v-model=\"email\"\n              type=\"text\"\n              class=\"input-field\"\n              required\n            />\n            <span class=\"icon\">üë§</span>\n          </div>\n        </div>\n        \n        <!-- Contrase√±a -->\n        <div class=\"mb-4\">\n          <label class=\"block text-gray-700\">Contrase√±a</label>\n          <div class=\"input-group\">\n            <input\n              v-model=\"password\"\n              type=\"password\"\n              class=\"input-field\"\n              required\n            />\n            <span class=\"icon\">üîí</span>\n          </div>\n        </div>\n\n        <!-- Bot√≥n de inicio de sesi√≥n -->\n        <button type=\"submit\" class=\"login-button\">\n          Iniciar sesi√≥n ‚Üí\n        </button>\n      </form>\n\n      <!-- Enlace para registrarse -->\n      <div class=\"text-center mt-4\">\n        <router-link to=\"/register\" class=\"text-blue-500 hover:underline\">\n          Reg√≠strarse aqu√≠\n        </router-link>\n      </div>\n    </div>\n  </div>\n\n  <!-- Modal para mostrar el tipo de usuario -->\n  <div v-if=\"showModal\" class=\"modal\">\n    <div class=\"modal-content\">\n      <span class=\"close\" @click=\"showModal = false\">&times;</span>\n      <p>Tipo de usuario: {{ userType }}</p>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref } from 'vue';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\nimport { useUserStore } from '@/stores/userStore'\nconst userStore = useUserStore();\n\n// Aseg√∫rate de tener definida la variable de entorno (p. ej., VUE_APP_IP)\nconst ip = process.env.VUE_APP_IP;\nconsole.log(\"IP del servidor: \" + ip);\n\nconst router = useRouter();\n\n// Campos reactivamente enlazados al formulario\nconst email = ref('');\nconst password = ref('');\nconst errorMessage = ref('');\nconst showModal = ref(false);\nconst userType = ref('');\nconst pharmacy = parseInt(window.location.port);\nconst pharmacy_port = pharmacy-30;\n// Funci√≥n principal de login\nconst login = async () => {\n  errorMessage.value = '';\n  \n  try {\n    console.log(\"Intentando iniciar sesi√≥n con:\", email.value);\n    \n    // Petici√≥n POST al backend\n    const response = await axios.post(`http://${ip}:${pharmacy_port}/api2/login`, {\n      email: email.value,\n      password: password.value\n    });\n\n    // Verificar si la respuesta tiene datos\n    if (!response.data) {\n      throw new Error(\"La respuesta no contiene datos\");\n    }\n\n    // Despu√©s de la petici√≥n POST exitosa\n    console.log(\"Login exitoso:\", response.data);\n\n    // Guardar el usuario en el store y localStorage\n    const userData = response.data;\n    \n    // Sanitizar y verificar los datos\n    if (!userData.role) {\n      userData.role = 'user'; // Rol por defecto si no viene\n    }\n    \n    // Guardar en el store\n    userStore.setUser(userData);\n\n    // Guardar expl√≠citamente en localStorage (respaldo adicional)\n    localStorage.setItem('user', JSON.stringify(userData));\n    localStorage.setItem('role', userData.role);\n    console.log(\"Usuario guardado en localStorage con rol:\", userData.role);\n\n    // Verificar el rol y redirigir seg√∫n corresponda\n    if (userData.role === 'admin') {\n      console.log(\"Redirigiendo a usuario admin a dashboard administrativo\");\n      router.push('/admindash');\n    } else {\n      console.log(\"Redirigiendo a usuario regular a inicio\");\n      router.push('/');\n    }\n  } catch (error) {\n    console.error(\"Error en el login:\", error);\n    errorMessage.value = 'Credenciales incorrectas o error en el servidor.';\n  }\n};\n</script>\n\n<style scoped>\n/* Ejemplo de estilos, ajusta a tu gusto. */\n.login-container {\n  display: flex;\n  height: 100vh;\n  background-color: #f8f9fa;\n}\n.login-image {\n  flex: 1;\n  background-image: url(@/assets/farmacialog.jpg);\n  background-position: center;\n  background-size: cover;\n}\n.login-box {\n  flex: 1;\n  background: white;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  padding: 50px;\n}\n.logo {\n  max-width: 150px;\n}\n.input-group {\n  position: relative;\n  width: 100%;\n}\n.input-field {\n  width: 100%;\n  padding: 12px 40px 12px 12px;\n  border: 1px solid #ccc;\n  border-radius: 8px;\n  font-size: 16px;\n}\n.icon {\n  position: absolute;\n  right: 10px;\n  top: 50%;\n  transform: translateY(-50%);\n}\n.login-button {\n  width: 100%;\n  background: #1e40af;\n  color: white;\n  padding: 12px;\n  border-radius: 8px;\n  font-size: 18px;\n  font-weight: bold;\n  cursor: pointer;\n  margin-top: 1rem;\n}\n.login-button:hover {\n  background: #1e3a8a;\n}\n\n.modal {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: fixed;\n  z-index: 1;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n}\n\n.modal-content {\n  background-color: white;\n  padding: 20px;\n  border-radius: 8px;\n  text-align: center;\n}\n\n.close {\n  position: absolute;\n  top: 10px;\n  right: 10px;\n  font-size: 24px;\n  cursor: pointer;\n}\n</style>"],"mappings":";OAOaA,UAAuB;;EAL7BC,KAAK,EAAC;AAAiB;;EAGrBA,KAAK,EAAC;AAAW;;EAL1BC,GAAA;EAe+BD,KAAK,EAAC;;;EAOxBA,KAAK,EAAC;AAAM;;EAEVA,KAAK,EAAC;AAAa;;EAYrBA,KAAK,EAAC;AAAM;;EAEVA,KAAK,EAAC;AAAa;;EAkBvBA,KAAK,EAAC;AAAkB;;EAxDnCC,GAAA;EAiEwBD,KAAK,EAAC;;;EACrBA,KAAK,EAAC;AAAe;;;uBAlE9BE,mBAAA,CAAAC,SAAA,SAEEC,mBAAA,CA4DM,OA5DNC,UA4DM,G,4BA3DJD,mBAAA,CAA+B;IAA1BJ,KAAK,EAAC;EAAa,6BAExBI,mBAAA,CAwDM,OAxDNE,UAwDM,G,4BAvDJF,mBAAA,CAEM;IAFDJ,KAAK,EAAC;EAAgB,IACzBI,mBAAA,CAAgE;IAA3DG,GAAuB,EAAvBR,UAAuB;IAACS,GAAG,EAAC,eAAe;IAACR,KAAK,EAAC;uDAGzDI,mBAAA,CAEK;IAFDJ,KAAK,EAAC;EAAmD,GAAC,kBAE9D,sBAEAS,mBAAA,gCAAmC,EACxBC,MAAA,CAAAC,YAAY,I,cAAvBT,mBAAA,CAEM,OAFNU,UAEM,EAAAC,gBAAA,CADDH,MAAA,CAAAC,YAAY,oBAhBvBF,mBAAA,gBAmBMA,mBAAA,gBAAmB,EACnBL,mBAAA,CAiCO;IAjCAU,QAAM,EAAAC,MAAA,QAAAA,MAAA,MApBnBC,cAAA,OAoBiCN,MAAA,CAAAO,KAAK;MAC9BR,mBAAA,YAAe,EACfL,mBAAA,CAWM,OAXNc,UAWM,G,0BAVJd,mBAAA,CAAiD;IAA1CJ,KAAK,EAAC;EAAqB,GAAC,QAAM,sBACzCI,mBAAA,CAQM,OARNe,UAQM,G,gBAPJf,mBAAA,CAKE;IA9Bd,uBAAAW,MAAA,QAAAA,MAAA,MAAAK,MAAA,IA0BuBV,MAAA,CAAAW,KAAK,GAAAD,MAAA;IACdE,IAAI,EAAC,MAAM;IACXtB,KAAK,EAAC,aAAa;IACnBuB,QAAQ,EAAR;iDAHSb,MAAA,CAAAW,KAAK,E,6BAKhBjB,mBAAA,CAA4B;IAAtBJ,KAAK,EAAC;EAAM,GAAC,IAAE,qB,KAIzBS,mBAAA,gBAAmB,EACnBL,mBAAA,CAWM,OAXNoB,UAWM,G,0BAVJpB,mBAAA,CAAqD;IAA9CJ,KAAK,EAAC;EAAqB,GAAC,YAAU,sBAC7CI,mBAAA,CAQM,OARNqB,UAQM,G,gBAPJrB,mBAAA,CAKE;IA5Cd,uBAAAW,MAAA,QAAAA,MAAA,MAAAK,MAAA,IAwCuBV,MAAA,CAAAgB,QAAQ,GAAAN,MAAA;IACjBE,IAAI,EAAC,UAAU;IACftB,KAAK,EAAC,aAAa;IACnBuB,QAAQ,EAAR;iDAHSb,MAAA,CAAAgB,QAAQ,E,6BAKnBtB,mBAAA,CAA4B;IAAtBJ,KAAK,EAAC;EAAM,GAAC,IAAE,qB,KAIzBS,mBAAA,+BAAkC,E,0BAClCL,mBAAA,CAES;IAFDkB,IAAI,EAAC,QAAQ;IAACtB,KAAK,EAAC;KAAe,oBAE3C,qB,4BAGFS,mBAAA,6BAAgC,EAChCL,mBAAA,CAIM,OAJNuB,UAIM,GAHJC,YAAA,CAEcC,sBAAA;IAFDC,EAAE,EAAC,WAAW;IAAC9B,KAAK,EAAC;;IAzD1C+B,OAAA,EAAAC,QAAA,CAyD0E,MAElEjB,MAAA,QAAAA,MAAA,OA3DRkB,gBAAA,CAyD0E,oBAElE,E;IA3DRC,CAAA;YAgEEzB,mBAAA,2CAA8C,EACnCC,MAAA,CAAAyB,SAAS,I,cAApBjC,mBAAA,CAKM,OALNkC,UAKM,GAJJhC,mBAAA,CAGM,OAHNiC,WAGM,GAFJjC,mBAAA,CAA6D;IAAvDJ,KAAK,EAAC,OAAO;IAAEsC,OAAK,EAAAvB,MAAA,QAAAA,MAAA,MAAAK,MAAA,IAAEV,MAAA,CAAAyB,SAAS;KAAU,GAAO,GACtD/B,mBAAA,CAAsC,WAAnC,mBAAiB,GAAAS,gBAAA,CAAGH,MAAA,CAAA6B,QAAQ,iB,OApErC9B,mBAAA,e","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
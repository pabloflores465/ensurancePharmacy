{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport Comentarios from '@/components/Comentarios.vue';\nimport axios from \"axios\";\nimport { ref } from \"vue\";\n//import { useUserStore } from '@/stores/userStore';\n// const userStore = useUserStore();\nconst isModalOpen = ref(false);\nconst cardNumber = ref('');\nconst cardExpiry = ref('');\nconst cardCvv = ref('');\nconst handleExpiryInput = () => {\n  // Remove non-digit characters\n  let val = cardExpiry.value.replace(/[^0-9]/g, '');\n  if (val.length > 2) {\n    cardExpiry.value = val.slice(0, 2) + '/' + val.slice(2, 4);\n  } else {\n    cardExpiry.value = val;\n  }\n};\nconst isCardValid = computed(() => {\n  return cardNumber.value && cardExpiry.value && cardCvv.value;\n});\nconst ip = process.env.VUE_APP_IP;\nexport default {\n  name: \"ProductoDetalle\",\n  components: {\n    Comentarios\n  },\n  // Se recibe el id del producto vía props (asegúrate de que el router lo pase correctamente)\n  props: [\"id\"],\n  data() {\n    return {\n      product: null,\n      quantity: 1,\n      productComments: [{\n        idComments: 1,\n        user: {\n          name: 'Juan'\n        },\n        commentText: '¡Muy buen producto!'\n      }, {\n        idComments: 2,\n        user: {\n          name: 'Maria'\n        },\n        commentText: 'Me ayudó mucho, gracias!'\n      }]\n    };\n  },\n  mounted() {\n    const routeId = this.$route.params.id;\n    axios.get(`http://${ip}:8081/api2/medicines`).then(response => {\n      //           console.log(\"Usuario: \",user)\n      const products = response.data;\n      console.log(this.$route.params.id);\n      this.product = products.find(prod => prod.idMedicine === Number(routeId));\n    }).catch(error => {\n      console.error('Error fetching medicines:', error);\n    });\n  },\n  methods: {\n    purchaseProduct() {\n      // Realiza el post con axios; la configuración la dejas como está para luego modificarla si lo deseas\n      axios.post(`http://${ip}:8081/api2/purchase`, {\n        productId: this.product.idMedicine,\n        quantity: this.quantity\n      }).then(response => {\n        console.log('Compra realizada:', response.data);\n      }).catch(error => {\n        console.error('Error en la compra:', error);\n      });\n    }\n  }\n};\nconst openModal = () => {\n  isModalOpen.value = true;\n};\nconst closeModal = () => {\n  isModalOpen.value = false;\n};\nconst completePurchase = async () => {\n  if (!isCardValid.value) return;\n  try {\n    // Create order with status 'Completado' and user id from prescription\n    const orderResponse = await axios.post(`http://${ip}:8081/api2/orders`, {\n      status: \"Completado\",\n      user: {\n        idUser: prescription.value.prescription.user.idUser\n      }\n    });\n    const order = orderResponse.data;\n\n    // For each medicine, calculate quantity and send to order_medicines API\n    for (const med of prescription.value.medicines) {\n      const quantity = Math.ceil(med.dosis * med.duracion / med.details.presentacion);\n      await axios.post(`http://${ip}:8081/api2/order_medicines`, {\n        orders: order,\n        medicine: {\n          idMedicine: med.idMedicine\n        },\n        quantity: quantity,\n        cost: med.price || 0,\n        total: (med.price || 0) * quantity\n      });\n    }\n    closeModal();\n    alert(\"Gracias por tu compra\");\n    window.location.href = \"/\";\n  } catch (error) {\n    console.error(\"Error completing purchase:\", error);\n    alert(\"Error al completar la compra. Intente de nuevo.\");\n  }\n};","map":{"version":3,"names":["Comentarios","axios","ref","isModalOpen","cardNumber","cardExpiry","cardCvv","handleExpiryInput","val","value","replace","length","slice","isCardValid","computed","ip","process","env","VUE_APP_IP","name","components","props","data","product","quantity","productComments","idComments","user","commentText","mounted","routeId","$route","params","id","get","then","response","products","console","log","find","prod","idMedicine","Number","catch","error","methods","purchaseProduct","post","productId","openModal","closeModal","completePurchase","orderResponse","status","idUser","prescription","order","med","medicines","Math","ceil","dosis","duracion","details","presentacion","orders","medicine","cost","price","total","alert","window","location","href"],"sources":["/Users/nohelestradap/Documents/VsCode/ensurancePharmacy/pharmacy/src/pages/ProductoDetalle.vue"],"sourcesContent":["<!-- eslint-disable vue/multi-word-component-names -->\n<template>\n    <div>\n      <h1>Detalle del Producto</h1>\n  \n      <!-- Si el producto existe, mostramos su información -->\n      <div v-if=\"product\">\n        <div class=\"product-container\" style=\"display: flex;\">\n          <div class=\"product-details\" style=\"flex: 1;\">\n            <h2>{{ product.name }}</h2>\n            <img\n              v-if=\"product.images && product.images.length\"\n              :src=\"product.images[0]\"\n              alt=\"Imagen principal del producto\"\n              style=\"width: 200px; border-radius: 8px;\"\n            />\n            <p><strong>Precio:</strong> Q{{ product.price }}</p>\n            <p><strong>Descripción:</strong> {{ product.description }}</p>\n            <p><strong>Inventario:</strong> {{ product.stock }} unidades</p>\n            <p><strong>Ingrediente Activo:</strong> {{ product.activeMedicament }}</p>\n            <p><strong>Descripción:</strong> {{ product.description }}</p>\n            <p><strong>Concentración:</strong> {{ product.concentration }}</p>\n            <p><strong>Presentación:</strong> {{ product.presentacion }}</p>\n            <p><strong>Marca:</strong> {{ product.brand }}</p>\n          </div>\n          <div class=\"purchase-section\" style=\"margin-left: 20px;\">\n            <label for=\"quantity\">Cantidad:</label>\n            <input\n              type=\"number\"\n              id=\"quantity\"\n              v-model.number=\"quantity\"\n              :min=\"1\"\n              :max=\"product.stock\"\n              style=\"width: 60px; margin-left: 10px;\"\n            />\n            <button\n              @click=\"purchaseProduct\"\n              :disabled=\"!quantity || quantity < 1 || quantity > product.stock\"\n              style=\"margin-left: 10px;\"\n            >\n              Comprar\n            </button>\n          </div>\n        </div>\n        <Comentarios :initialComments=\"productComments\" />\n      </div>\n      <!-- Si no existe el producto, mostramos un mensaje de error -->\n      <div v-else>\n        <p>Producto no encontrado.</p>\n      </div>\n      <div v-if=\"prescription && allMedicinesAvailable\" class=\"complete-purchase-container\" style=\"margin-top: 20px; text-align: center;\">\n        <button @click=\"openModal\" class=\"complete-purchase-button\" style=\"padding: 10px 20px; font-size: 16px;\">Completar compra</button>\n      </div>\n\n      <!-- Modal for credit card details -->\n      <div v-if=\"isModalOpen\" class=\"modal-overlay\" style=\"position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;\">\n        <div class=\"modal-content\" style=\"background: #fff; padding: 20px; border-radius: 5px; width: 300px; text-align: center;\">\n          <h3>Datos de Tarjeta</h3>\n          <input v-model=\"cardNumber\" placeholder=\"Número de tarjeta\" style=\"width: 100%; padding: 8px; margin: 5px 0;\" />\n          <input v-model=\"cardExpiry\" @input=\"handleExpiryInput\" placeholder=\"MM/AA\" style=\"width: 100%; padding: 8px; margin: 5px 0;\" />\n          <input v-model=\"cardCvv\" placeholder=\"CVV\" style=\"width: 100%; padding: 8px; margin: 5px 0;\" />\n          <button :disabled=\"!isCardValid\" @click=\"completePurchase\" style=\"padding: 8px 16px; margin-top: 10px;\">Comprar</button>\n          <button @click=\"closeModal\" style=\"padding: 8px 16px; margin-top: 10px; margin-left: 10px;\">Cancelar</button>\n        </div>\n      </div>\n    </div>\n  </template>\n\n  <script>\n  import Comentarios from '@/components/Comentarios.vue';\n  import axios from \"axios\";\n  import {ref} from \"vue\";\n  //import { useUserStore } from '@/stores/userStore';\n // const userStore = useUserStore();\n  const isModalOpen = ref(false);\n  const cardNumber = ref('');\n  const cardExpiry = ref('');\n  const cardCvv = ref('');\n\n  const handleExpiryInput = () => {\n    // Remove non-digit characters\n    let val = cardExpiry.value.replace(/[^0-9]/g, '');\n    if (val.length > 2) {\n      cardExpiry.value = val.slice(0, 2) + '/' + val.slice(2, 4);\n    } else {\n      cardExpiry.value = val;\n    }\n  };\n\n  const isCardValid = computed(() => {\n    return cardNumber.value && cardExpiry.value && cardCvv.value;\n  });\n\n  const ip = process.env.VUE_APP_IP;\n\n  export default {\n    name: \"ProductoDetalle\",\n    components: {\n      Comentarios\n    },\n    // Se recibe el id del producto vía props (asegúrate de que el router lo pase correctamente)\n    props: [\"id\"],\n    data() {\n      return {\n        product: null,\n        quantity: 1,\n        productComments: [\n          { idComments: 1, user: { name: 'Juan' }, commentText: '¡Muy buen producto!' },\n          { idComments: 2, user: { name: 'Maria' }, commentText: 'Me ayudó mucho, gracias!' }\n        ]\n      };\n    },\n    mounted() {\n      const routeId = this.$route.params.id;\n      axios.get(`http://${ip}:8081/api2/medicines`)\n          .then(response => {\n //           console.log(\"Usuario: \",user)\n            const products = response.data;\n            console.log(this.$route.params.id);\n            this.product = products.find(prod => prod.idMedicine === Number(routeId));\n          })\n          .catch(error => {\n            console.error('Error fetching medicines:', error);\n          });\n    },\n    methods: {\n      purchaseProduct() {\n        // Realiza el post con axios; la configuración la dejas como está para luego modificarla si lo deseas\n        axios.post(`http://${ip}:8081/api2/purchase`, {\n          productId: this.product.idMedicine,\n          quantity: this.quantity\n        })\n        .then(response => {\n          console.log('Compra realizada:', response.data);\n        })\n        .catch(error => {\n          console.error('Error en la compra:', error);\n        });\n      }\n    }\n  };\n  const openModal = () => {\n    isModalOpen.value = true;\n  };\n\n  const closeModal = () => {\n    isModalOpen.value = false;\n  };\n  const completePurchase = async () => {\n    if (!isCardValid.value) return;\n    try {\n      // Create order with status 'Completado' and user id from prescription\n      const orderResponse = await axios.post(`http://${ip}:8081/api2/orders`, {\n        status: \"Completado\",\n        user: { idUser: prescription.value.prescription.user.idUser }\n      });\n      const order = orderResponse.data;\n\n      // For each medicine, calculate quantity and send to order_medicines API\n      for (const med of prescription.value.medicines) {\n        const quantity = Math.ceil((med.dosis * med.duracion) / med.details.presentacion);\n        await axios.post(`http://${ip}:8081/api2/order_medicines`, {\n          orders: order,\n          medicine: { idMedicine: med.idMedicine },\n          quantity: quantity,\n          cost: med.price || 0,\n          total: (med.price || 0) * quantity\n        });\n      }\n\n      closeModal();\n      alert(\"Gracias por tu compra\");\n      window.location.href = \"/\";\n    } catch (error) {\n      console.error(\"Error completing purchase:\", error);\n      alert(\"Error al completar la compra. Intente de nuevo.\");\n    }\n  };\n  </script>\n  \n  <style scoped>\n  /* Estilos opcionales */\n  </style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
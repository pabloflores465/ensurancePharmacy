{"ast":null,"code":"import { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, resolveComponent as _resolveComponent, createBlock as _createBlock, vModelText as _vModelText, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = {\n  class: \"comments-container\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"reply-info\"\n};\nconst _hoisted_3 = {\n  key: 1\n};\nconst _hoisted_4 = {\n  key: 2\n};\nconst _hoisted_5 = {\n  class: \"add-comment\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_CommentItem = _resolveComponent(\"CommentItem\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[4] || (_cache[4] = _createElementVNode(\"h3\", null, \"Comentarios\", -1 /* HOISTED */)), $setup.replyComment ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createTextVNode(\" Respondiendo a \" + _toDisplayString($setup.replyComment.user.name) + \" \", 1 /* TEXT */), _createElementVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = (...args) => $setup.cancelReply && $setup.cancelReply(...args))\n  }, \"Cancelar Respuesta\")])) : _createCommentVNode(\"v-if\", true), $setup.comments.length ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.topLevelComments, comment => {\n    return _openBlock(), _createBlock(_component_CommentItem, {\n      key: comment.idComments,\n      comment: comment,\n      \"all-comments\": $setup.comments,\n      onReply: $setup.setReply\n    }, null, 8 /* PROPS */, [\"comment\", \"all-comments\", \"onReply\"]);\n  }), 128 /* KEYED_FRAGMENT */))])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_4, _cache[3] || (_cache[3] = [_createElementVNode(\"p\", null, \"No hay comentarios aún.\", -1 /* HOISTED */)]))), _createElementVNode(\"div\", _hoisted_5, [_withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.newCommentText = $event),\n    placeholder: \"Escribe un comentario...\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.newCommentText]]), _createElementVNode(\"button\", {\n    onClick: _cache[2] || (_cache[2] = (...args) => $setup.addComment && $setup.addComment(...args))\n  }, \"Agregar Comentario\")])]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createElementVNode","$setup","replyComment","_hoisted_2","_createTextVNode","_toDisplayString","user","name","onClick","_cache","args","cancelReply","_createCommentVNode","comments","length","_hoisted_3","_Fragment","_renderList","topLevelComments","comment","_createBlock","_component_CommentItem","idComments","onReply","setReply","_hoisted_4","_hoisted_5","$event","newCommentText","placeholder","addComment"],"sources":["/Users/nohelestradap/Documents/VsCode/ensurancePharmacy/pharmacy/src/components/Comentarios.vue"],"sourcesContent":["<template>\n  <div class=\"comments-container\">\n    <h3>Comentarios</h3>\n    <div v-if=\"replyComment\" class=\"reply-info\">\n      Respondiendo a {{ replyComment.user.name }}\n      <button @click=\"cancelReply\">Cancelar Respuesta</button>\n    </div>\n    <div v-if=\"comments.length\">\n      <CommentItem\n          v-for=\"comment in topLevelComments\"\n          :key=\"comment.idComments\"\n          :comment=\"comment\"\n          :all-comments=\"comments\"\n          @reply=\"setReply\"\n      />\n    </div>\n    <div v-else>\n      <p>No hay comentarios aún.</p>\n    </div>\n    <div class=\"add-comment\">\n      <input v-model=\"newCommentText\" placeholder=\"Escribe un comentario...\" />\n      <button @click=\"addComment\">Agregar Comentario</button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, computed, onMounted } from 'vue';\nimport { useRoute } from 'vue-router';\nimport { useUserStore } from \"@/stores/userStore\";\nimport CommentItem from './CommentItem.vue';\n\nconst ip = process.env.VUE_APP_IP;\n\nexport default {\n  name: 'ProductComments',\n  components: { CommentItem },\n  props: {\n    initialComments: {\n      type: Array,\n      default: () => []\n    }\n  },\n  setup(props) {\n    const userStore = useUserStore();\n    const route = useRoute();\n    const routeId = route.params.id;\n    const comments = ref(props.initialComments);\n    const newCommentText = ref('');\n    const replyComment = ref(null);\n\n    onMounted(async () => {\n      try {\n        console.log(ip);\n        const res = await fetch(`http://${ip}:8081/api2/comments`);\n        if (res.ok) {\n          const data = await res.json();\n          console.log('Comentarios obtenidos:', data);\n          comments.value = data;\n        }\n      } catch (error) {\n        console.error('Error al obtener comentarios', error);\n      }\n    });\n\n    const topLevelComments = computed(() => {\n      const filtered = comments.value.filter(c => !c.prevComment);\n      console.log('Top level comments sin filtro:', filtered);\n      return filtered;\n    });\n\n    const addComment = async () => {\n      if(newCommentText.value) {\n        const payload = {\n          user: userStore.user,\n          prevComment: replyComment.value,\n          commentText: newCommentText.value,\n          medicine: { idMedicine: routeId }\n        };\n        try {\n          const res = await fetch(`http://${ip}:8081/api2/comments`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(payload)\n          });\n          if(res.ok) {\n            const newComment = await res.json();\n            comments.value.push(newComment);\n            newCommentText.value = '';\n            replyComment.value = null;\n          } else {\n            console.error('Error al crear comentario');\n          }\n        } catch(error) {\n          console.error('Error en la petición POST', error);\n        }\n      }\n    };\n\n    const setReply = (comment) => {\n      replyComment.value = comment;\n    };\n\n    const cancelReply = () => {\n      replyComment.value = null;\n    };\n\n    return {\n      comments,\n      topLevelComments,\n      newCommentText,\n      addComment,\n      replyComment,\n      setReply,\n      cancelReply\n    };\n  }\n};\n</script>\n\n<style scoped>\n.comments-container {\n  margin-top: 20px;\n}\n\n.reply-info {\n  background: #eef;\n  padding: 5px 10px;\n  border-radius: 5px;\n  margin-bottom: 10px;\n}\n\n.add-comment {\n  margin-top: 20px;\n}\n\n.add-comment input,\n.add-comment textarea {\n  width: 100%;\n  padding: 10px;\n  margin-bottom: 10px;\n  border: 1px solid #ccc;\n  border-radius: 5px;\n}\n\n.add-comment button {\n  padding: 10px 15px;\n  background: #1e40af;\n  color: white;\n  border: none;\n  border-radius: 5px;\n  cursor: pointer;\n}\n\n.add-comment button:hover {\n  background: #1e3a8a;\n}\n</style>"],"mappings":";;EACOA,KAAK,EAAC;AAAoB;;EADjCC,GAAA;EAG6BD,KAAK,EAAC;;;EAHnCC,GAAA;AAAA;;EAAAA,GAAA;AAAA;;EAmBSD,KAAK,EAAC;AAAa;;;uBAlB1BE,mBAAA,CAsBM,OAtBNC,UAsBM,G,0BArBJC,mBAAA,CAAoB,YAAhB,aAAW,sBACJC,MAAA,CAAAC,YAAY,I,cAAvBJ,mBAAA,CAGM,OAHNK,UAGM,GANVC,gBAAA,CAGgD,kBAC3B,GAAAC,gBAAA,CAAGJ,MAAA,CAAAC,YAAY,CAACI,IAAI,CAACC,IAAI,IAAG,GAC3C,iBAAAP,mBAAA,CAAwD;IAA/CQ,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAET,MAAA,CAAAU,WAAA,IAAAV,MAAA,CAAAU,WAAA,IAAAD,IAAA,CAAW;KAAE,oBAAkB,E,KALrDE,mBAAA,gBAOeX,MAAA,CAAAY,QAAQ,CAACC,MAAM,I,cAA1BhB,mBAAA,CAQM,OAfViB,UAAA,I,kBAQMjB,mBAAA,CAMEkB,SAAA,QAdRC,WAAA,CAS4BhB,MAAA,CAAAiB,gBAAgB,EAA3BC,OAAO;yBADlBC,YAAA,CAMEC,sBAAA;MAJGxB,GAAG,EAAEsB,OAAO,CAACG,UAAU;MACvBH,OAAO,EAAEA,OAAO;MAChB,cAAY,EAAElB,MAAA,CAAAY,QAAQ;MACtBU,OAAK,EAAEtB,MAAA,CAAAuB;;qDAGd1B,mBAAA,CAEM,OAlBV2B,UAAA,EAAAhB,MAAA,QAAAA,MAAA,OAiBMT,mBAAA,CAA8B,WAA3B,yBAAuB,oB,KAE5BA,mBAAA,CAGM,OAHN0B,UAGM,G,gBAFJ1B,mBAAA,CAAyE;IApB/E,uBAAAS,MAAA,QAAAA,MAAA,MAAAkB,MAAA,IAoBsB1B,MAAA,CAAA2B,cAAc,GAAAD,MAAA;IAAEE,WAAW,EAAC;iDAA5B5B,MAAA,CAAA2B,cAAc,E,GAC9B5B,mBAAA,CAAuD;IAA9CQ,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAET,MAAA,CAAA6B,UAAA,IAAA7B,MAAA,CAAA6B,UAAA,IAAApB,IAAA,CAAU;KAAE,oBAAkB,E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
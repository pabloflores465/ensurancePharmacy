{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport { ref, computed, onMounted } from 'vue';\nimport { useRoute } from 'vue-router';\nimport { useUserStore } from \"@/stores/userStore\";\nimport CommentItem from './CommentItem.vue';\nconst ip = process.env.VUE_APP_IP;\nexport default {\n  name: 'ProductComments',\n  components: {\n    CommentItem\n  },\n  props: {\n    initialComments: {\n      type: Array,\n      default: () => []\n    }\n  },\n  setup(props) {\n    const userStore = useUserStore();\n    const route = useRoute();\n    const routeId = route.params.id;\n    const comments = ref(props.initialComments);\n    const newCommentText = ref('');\n    const replyComment = ref(null);\n    const isLoggedIn = computed(() => {\n      return !!(userStore.user && userStore.user.idUser);\n    });\n    onMounted(async () => {\n      try {\n        console.log(ip);\n        const res = await fetch(`http://${ip}:8081/api2/comments`);\n        if (res.ok) {\n          const data = await res.json();\n          console.log('Comentarios obtenidos:', data);\n          comments.value = data;\n        }\n      } catch (error) {\n        console.error('Error al obtener comentarios', error);\n      }\n    });\n    const topLevelComments = computed(() => {\n      const filtered = comments.value.filter(c => !c.prevComment && c.medicine && Number(c.medicine.idMedicine) === Number(routeId));\n      console.log('Top level comments filtrados por producto:', filtered);\n      return filtered;\n    });\n    const addComment = async () => {\n      if (newCommentText.value) {\n        const payload = {\n          user: userStore.user,\n          commentText: newCommentText.value,\n          medicine: {\n            idMedicine: Number(routeId)\n          }\n        };\n        if (replyComment.value) {\n          payload.prevComment = replyComment.value;\n        }\n        try {\n          const res = await fetch(`http://${ip}:8081/api2/comments`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(payload)\n          });\n          if (res.ok) {\n            const newComment = await res.json();\n            comments.value.push(newComment);\n            newCommentText.value = '';\n            replyComment.value = null;\n          } else {\n            console.error('Error al crear comentario');\n            console.log(JSON.stringify(payload));\n          }\n        } catch (error) {\n          console.error('Error en la petición POST', error);\n        }\n      }\n    };\n    const setReply = comment => {\n      replyComment.value = comment;\n    };\n    const cancelReply = () => {\n      replyComment.value = null;\n    };\n    return {\n      comments,\n      topLevelComments,\n      newCommentText,\n      addComment,\n      replyComment,\n      setReply,\n      cancelReply,\n      isLoggedIn\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","useRoute","useUserStore","CommentItem","ip","process","env","VUE_APP_IP","name","components","props","initialComments","type","Array","default","setup","userStore","route","routeId","params","id","comments","newCommentText","replyComment","isLoggedIn","user","idUser","console","log","res","fetch","ok","data","json","value","error","topLevelComments","filtered","filter","c","prevComment","medicine","Number","idMedicine","addComment","payload","commentText","method","headers","body","JSON","stringify","newComment","push","setReply","comment","cancelReply"],"sources":["/Users/nohelestradap/Documents/VsCode/ensurancePharmacy/pharmacy/src/components/Comentarios.vue"],"sourcesContent":["<template>\n  <div class=\"comments-container\">\n    <h3>Comentarios</h3>\n    <div v-if=\"replyComment\" class=\"reply-info\">\n      Respondiendo a {{ replyComment.user.name }}\n      <button @click=\"cancelReply\">Cancelar Respuesta</button>\n    </div>\n    <div v-if=\"comments.length\">\n      <CommentItem\n          v-for=\"comment in topLevelComments\"\n          :key=\"comment.idComments\"\n          :comment=\"comment\"\n          :all-comments=\"comments\"\n          @reply=\"setReply\"\n      />\n    </div>\n    <div v-else>\n      <p>No hay comentarios aún.</p>\n    </div>\n    <div class=\"add-comment\" v-if=\"isLoggedIn\">\n      <input v-model=\"newCommentText\" placeholder=\"Escribe un comentario...\" />\n      <button @click=\"addComment\">Agregar Comentario</button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, computed, onMounted } from 'vue';\nimport { useRoute } from 'vue-router';\nimport { useUserStore } from \"@/stores/userStore\";\nimport CommentItem from './CommentItem.vue';\n\nconst ip = process.env.VUE_APP_IP;\n\nexport default {\n  name: 'ProductComments',\n  components: { CommentItem },\n  props: {\n    initialComments: {\n      type: Array,\n      default: () => []\n    }\n  },\n  setup(props) {\n    const userStore = useUserStore();\n    const route = useRoute();\n    const routeId = route.params.id;\n    const comments = ref(props.initialComments);\n    const newCommentText = ref('');\n    const replyComment = ref(null);\n    const isLoggedIn = computed(() => {\n      return !!(userStore.user && userStore.user.idUser);\n    });\n\n    onMounted(async () => {\n      try {\n        console.log(ip);\n        const res = await fetch(`http://${ip}:8081/api2/comments`);\n        if (res.ok) {\n          const data = await res.json();\n          console.log('Comentarios obtenidos:', data);\n          comments.value = data;\n        }\n      } catch (error) {\n        console.error('Error al obtener comentarios', error);\n      }\n    });\n\n    const topLevelComments = computed(() => {\n      const filtered = comments.value.filter(c =>\n        !c.prevComment && c.medicine && Number(c.medicine.idMedicine) === Number(routeId)\n      );\n      console.log('Top level comments filtrados por producto:', filtered);\n      return filtered;\n    });\n\n    const addComment = async () => {\n      if(newCommentText.value) {\n        const payload = {\n          user: userStore.user,\n          commentText: newCommentText.value,\n          medicine: { idMedicine: Number(routeId) }\n        };\n\n        if (replyComment.value) {\n          payload.prevComment = replyComment.value;\n        }\n\n        try {\n          const res = await fetch(`http://${ip}:8081/api2/comments`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(payload)\n          });\n          if(res.ok) {\n            const newComment = await res.json();\n            comments.value.push(newComment);\n            newCommentText.value = '';\n            replyComment.value = null;\n          } else {\n            console.error('Error al crear comentario');\n            console.log(JSON.stringify((payload)))\n          }\n        } catch(error) {\n          console.error('Error en la petición POST', error);\n        }\n      }\n    };\n\n    const setReply = (comment) => {\n      replyComment.value = comment;\n    };\n\n    const cancelReply = () => {\n      replyComment.value = null;\n    };\n\n    return {\n      comments,\n      topLevelComments,\n      newCommentText,\n      addComment,\n      replyComment,\n      setReply,\n      cancelReply,\n      isLoggedIn\n    };\n  }\n};\n</script>\n\n<style scoped>\n.comments-container {\n  margin-top: 20px;\n}\n\n.reply-info {\n  background: #eef;\n  padding: 5px 10px;\n  border-radius: 5px;\n  margin-bottom: 10px;\n}\n\n.add-comment {\n  margin-top: 20px;\n}\n\n.add-comment input,\n.add-comment textarea {\n  width: 100%;\n  padding: 10px;\n  margin-bottom: 10px;\n  border: 1px solid #ccc;\n  border-radius: 5px;\n}\n\n.add-comment button {\n  padding: 10px 15px;\n  background: #1e40af;\n  color: white;\n  border: none;\n  border-radius: 5px;\n  cursor: pointer;\n}\n\n.add-comment button:hover {\n  background: #1e3a8a;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
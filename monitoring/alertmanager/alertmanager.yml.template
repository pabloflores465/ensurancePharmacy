# Alertmanager Configuration - Ensurance Pharmacy
# ARCHIVO GENERADO AUTOMÃTICAMENTE - NO EDITAR MANUALMENTE
# Edita .env.alertmanager y ejecuta ./setup-alertmanager-secrets.sh

global:
  resolve_timeout: 5m
  smtp_smarthost: 'smtp-relay.brevo.com:587'
  smtp_from: '945b13001@smtp-brevo.com'
  smtp_auth_username: '945b13001@smtp-brevo.com'
  smtp_auth_password: 'REPLACE_WITH_YOUR_SMTP_TOKEN'
  smtp_require_tls: true

route:
  receiver: 'default-notifications'
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 3h
  group_by: ['alertname', 'cluster', 'service']
  
  routes:
    - match:
        severity: critical
      receiver: 'critical-notifications'
      group_wait: 0s
      repeat_interval: 5m
      
    - match:
        severity: warning
      receiver: 'warning-notifications'
      repeat_interval: 1h
      
    - match:
        severity: info
      receiver: 'info-notifications'
      repeat_interval: 6h

receivers:
  - name: 'default-notifications'
    email_configs:
      - to: 'pablopolis2016@gmail.com,jflores@unis.edu.gt'
        headers:
          Subject: '[Ensurance Pharmacy] Alerta de Monitoreo'
        html: |
          <h2>Alerta de Monitoreo - Ensurance Pharmacy</h2>
          <p><strong>Estado:</strong> {{ .Status }}</p>
          <p><strong>Severidad:</strong> {{ .CommonLabels.severity }}</p>
          <p><strong>Alerta:</strong> {{ .CommonLabels.alertname }}</p>
          <p><strong>DescripciÃ³n:</strong> {{ .CommonAnnotations.description }}</p>
          <p><strong>Resumen:</strong> {{ .CommonAnnotations.summary }}</p>
          <p><strong>Tiempo:</strong> {{ .StartsAt }}</p>
          <hr>
          <p><em>Sistema de Monitoreo AutomÃ¡tico - Ensurance Pharmacy</em></p>
  
  - name: 'critical-notifications'
    email_configs:
      - to: 'pablopolis2016@gmail.com,jflores@unis.edu.gt'
        headers:
          Subject: 'ğŸ”´ [CRÃTICO] Alerta Urgente - Ensurance Pharmacy'
        html: |
          <div style="background-color: #ff0000; color: white; padding: 20px;">
            <h1>âš ï¸ ALERTA CRÃTICA âš ï¸</h1>
          </div>
          <h2>Ensurance Pharmacy - AcciÃ³n Inmediata Requerida</h2>
          <p><strong>ğŸ”´ Severidad:</strong> CRÃTICO</p>
          <p><strong>ğŸ“› Alerta:</strong> {{ .CommonLabels.alertname }}</p>
          <p><strong>ğŸ“ DescripciÃ³n:</strong> {{ .CommonAnnotations.description }}</p>
          <p><strong>ğŸ’¡ Resumen:</strong> {{ .CommonAnnotations.summary }}</p>
          <p><strong>ğŸ• Inicio:</strong> {{ .StartsAt }}</p>
          <p><strong>ğŸ¯ Servicio:</strong> {{ .CommonLabels.service }}</p>
          <p><strong>ğŸ–¥ï¸ Instancia:</strong> {{ .CommonLabels.instance }}</p>
          <hr>
          <p style="color: red;"><strong>âš¡ ACCIÃ“N REQUERIDA INMEDIATAMENTE</strong></p>
          <p><em>Sistema de Monitoreo CrÃ­tico - Ensurance Pharmacy</em></p>
  
  - name: 'warning-notifications'
    email_configs:
      - to: 'pablopolis2016@gmail.com,jflores@unis.edu.gt'
        headers:
          Subject: 'âš ï¸ [WARNING] Alerta de Monitoreo - Ensurance Pharmacy'
        html: |
          <div style="background-color: #ffa500; color: white; padding: 20px;">
            <h2>âš ï¸ Advertencia de Monitoreo</h2>
          </div>
          <h2>Ensurance Pharmacy</h2>
          <p><strong>âš ï¸ Severidad:</strong> WARNING</p>
          <p><strong>ğŸ“› Alerta:</strong> {{ .CommonLabels.alertname }}</p>
          <p><strong>ğŸ“ DescripciÃ³n:</strong> {{ .CommonAnnotations.description }}</p>
          <p><strong>ğŸ’¡ Resumen:</strong> {{ .CommonAnnotations.summary }}</p>
          <p><strong>ğŸ• Inicio:</strong> {{ .StartsAt }}</p>
          <p><strong>ğŸ¯ Servicio:</strong> {{ .CommonLabels.service }}</p>
          <hr>
          <p><em>Sistema de Monitoreo - Ensurance Pharmacy</em></p>
  
  - name: 'info-notifications'
    email_configs:
      - to: 'pablopolis2016@gmail.com,jflores@unis.edu.gt'
        headers:
          Subject: 'â„¹ï¸ [INFO] NotificaciÃ³n - Ensurance Pharmacy'
        html: |
          <h2>NotificaciÃ³n Informativa - Ensurance Pharmacy</h2>
          <p><strong>â„¹ï¸ Severidad:</strong> INFO</p>
          <p><strong>ğŸ“› Alerta:</strong> {{ .CommonLabels.alertname }}</p>
          <p><strong>ğŸ“ DescripciÃ³n:</strong> {{ .CommonAnnotations.description }}</p>
          <p><strong>ğŸ• Tiempo:</strong> {{ .StartsAt }}</p>
          <hr>
          <p><em>Sistema de Monitoreo - Ensurance Pharmacy</em></p>

inhibit_rules:
  - source_match:
      severity: 'critical'
      alertname: 'InstanceDown'
    target_match:
      severity: 'warning'
    equal: ['instance']
  
  - source_match:
      severity: 'critical'
      alertname: 'HighCPUUsage'
    target_match:
      alertname: 'HighCPUUsage'
      severity: 'warning'
    equal: ['instance']
